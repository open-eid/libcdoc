<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcdoc: libcdoc Tool Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcdoc<span id="projectnumber">&#160;0.1.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2libcdoc_2libcdoc_2doc_2tool.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">libcdoc Tool Usage</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md53"></a> The <b>libcdoc</b> library includes a command-line tool, <b>cdoc-tool</b> (or <b>cdoc-tool.exe</b> on Windows), which can be used to encrypt and decrypt files, as well as view the locks in an encrypted container. The tool is compatible with Windows, macOS, and Linux platforms.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md55"></a>
Encryption</h1>
<p>The general syntax for encrypting files for one or more recipients is the following:</p>
<div class="fragment"><div class="line">cdoc-tool encrypt --rcpt RECIPIENT [--rcpt...] [-v1] [--genlabel]</div>
<div class="line">    [--library PKCS11_LIBRARY]</div>
<div class="line">    [--server ID URL(s)]</div>
<div class="line">    [--accept SERVER_CERT_FILENAME]</div>
<div class="line">    --out OUTPUTFILE</div>
<div class="line">    FILE1 [FILE2 FILE3... FILEn]</div>
</div><!-- fragment --><p>To re-encrypt a file for a different recipient(s) or with a different encryption method, use the <b>re-encrypt</b> switch instead of <b>encrypt</b>. For that both decryption and encryption options have to be specified.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
Options</h2>
<ul>
<li><code>-v1</code> - generates CDOC ver. 1 format container instead of CDOC ver. 2 container. The option can be used only when encrypting with public-key certificate (see Recipients). In all other cases, CDOC ver. 2 format container is created. Tool gives an error if the option is used with any other encryption method.</li>
<li><code>--genlabel</code> - causes machine-readable label generation for the lock instead of using label provided with <code>--rcpt</code> option. The machine-readable label follows the format described in <a href="https://open-eid.github.io/CDOC2/1.1/02_protocol_and_cryptography_spec/ch03_container_format/#keylabel-recommendations">5.1.2.1 KeyLabel recommendations</a> chapter of <em>CDOC2 container format</em> specification, and differs depending on selected encryption method.</li>
<li><code>--library</code> - path to the PKCS11 library that handles smart-card related operations. The option is needed only in MacOS and Linux when <code>p11sk</code> or <code>p11pk</code> encryption method is used (see Recipients). In Windows the tool uses API provided by Windows. In all other cases the option is ignored.</li>
<li><code>--server ID URL(s)</code> - specifies a key or share server. The recipient key will be stored in server instead of container. For key server the URL is either fetch or send URL. For share server it is comma-separated list of share server URLs.</li>
<li><code>--accept SERVER_CERT_FILENAME</code> - path to server's TLS certificate file. The certificate must be in DER format. Needed only if a key or shared server is used, i.e. <code>--server</code> option is specified.</li>
<li><code>--out OUTPUTFILE</code> - CDOC file name to be created. This option is mandatory. If the file name is provided without path then the file is created in current working directory.</li>
<li><code>FILE</code> - one or more files to be encrypted. At least one file must be provided.</li>
</ul>
<h2><a class="anchor" id="autotoc_md57"></a>
Recipients</h2>
<p>One or more recipients must be specified, each with its own encryption method.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Form   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[label]:cert:CERTIFICATE_HEX</code>   </td><td class="markdownTableBodyNone">Encryption public-key from certificate. The certificate must be provided as hex-encoded string    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[label]:skey:SECRET_KEY_HEX</code>   </td><td class="markdownTableBodyNone">Symmetric encryption with AES key. The key must be provided as hex-encoded string    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[label]:pkey:SECRET_KEY_HEX</code>   </td><td class="markdownTableBodyNone">Encryption with public-key. The key must be provided as hex-encoded string    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[label]:pfkey:PUB_KEY_FILE</code>   </td><td class="markdownTableBodyNone">Encryption with public-key where the key is provided via path to DER file with EC (<b>secp384r1</b> curve) public key    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[label]:pw:PASSWORD</code>   </td><td class="markdownTableBodyNone">Encryption with derive key using PWBKDF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[label]:p11sk:SLOT:[PIN]:[PKCS11 ID]:[PKCS11 LABEL]</code>   </td><td class="markdownTableBodyNone">Encryption with AES key from PKCS11 module    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[label]:p11pk:SLOT:[PIN]:[PKCS11 ID]:[PKCS11 LABEL]</code>   </td><td class="markdownTableBodyNone">Encryption with public key from PKCS11 module    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[label]:share:ID</code>   </td><td class="markdownTableBodyNone">use key share server with given ID (personal code)   </td></tr>
</table>
<p>If the <code>label</code> is omitted then the <code>--genlabel</code> option must be specified at command-line. Otherwise, the tool generates an error. If both, <code>label</code> and <code>--genlabel</code> option are provided then depending on encryption method, the <code>label</code> may be ignored, but may be also used a part of machine-readable label, like in encrypting with symmetric key and password case. Refer <a href="https://open-eid.github.io/CDOC2/1.1/02_protocol_and_cryptography_spec/appendix_d_keylabel/">Appendix D</a> section of <em>CDOC2 container format</em> specification for examples of machine-readable key-labels.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Examples</h2>
<ol type="1">
<li><p class="startli"><b>Encrypt a file with a password</b> <br  />
 Encrypt the file <code>abc.txt</code> with the password <code>Test123</code>. The resulting container is <code>abc.txt-pw.cdoc</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool encrypt --rcpt Test:pw:Test123 --out abc.txt-pw.cdoc abc.txt</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Encrypt a file with a public key from an ID card</b> <br  />
 Encrypt the file <code>abc.txt</code> using a public key from an Estonian ID card. The resulting container is <code>abc.txt-p11pk.cdoc</code>. To use the ID card a PKCS11 library has to be specified, the exact location depends on the operating system and installed software.</p>
<div class="fragment"><div class="line">./cdoc-tool encrypt --rcpt :p11pk:0:::Isikutuvastus --genlabel --out abc.txt-p11pk.cdoc --library /opt/homebrew/lib/opensc-pkcs11.so abc.txt</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Encrypt a file with a public key from a file</b> <br  />
 Encrypt the file <code>abc.txt</code> using a public key from the file <code>ec-secp384r1-pub.der</code>. The resulting container is <code>abc.txt-pfkey.cdoc</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool encrypt --rcpt :pfkey:ec-secp384r1-pub.der --genlabel --out abc.txt-pfkey.cdoc abc.txt</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Encrypt a file with an AES key</b> <br  />
 Encrypt the file <code>abc.txt</code> using an AES key provided via the command line. The resulting container is <code>abc.txt-aes.cdoc</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool encrypt --rcpt Test:skey:E165475C6D8B9DD0B696EE2A37D7176DFDF4D7B510406648E70BAE8E80493E5E --genlabel --out abc.txt-aes.cdoc abc.txt</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Encrypt a file with a public key from an ID card and use key server</b> <br  />
 Encrypt the file <code>abc.txt</code> using a public key from an Estonian ID card and use the RIA key server. The resulting container is <code>abc.txt-ks.cdoc</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool encrypt --rcpt Test:p11pk:0:::Isikutuvastus --library /opt/homebrew/lib/opensc-pkcs11.so --server 00000000-0000-0000-0000-000000000000 https://cdoc2.id.ee:8443 --accept keyserver-cert.der --out abc.txt-ks.cdoc abc.txt</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md60"></a>
Decryption</h1>
<p>The syntax for decrypting an encrypted file is the following:</p>
<div class="fragment"><div class="line">cdoc-tool decrypt OPTIONS FILE [OUTPUT_DIR]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
Options</h2>
<p>Following options are supported:</p>
<ul>
<li><code>--label LABEL</code> - CDOC container's lock label. Either the label or label's index must be provided.</li>
<li><code>--label_idx INDEX</code> - CDOC container's lock 1-based label index. Either the label or label's index must be provided.</li>
<li><code>--slot SLOT</code> - PKCS11 slot number. Usually 0.</li>
<li><code>--password PASSWORD</code> - lock's password if the file was encrypted with password.</li>
<li><code>--secret SECRET</code> - secret phrase (AES key) if the file was encrypted with symmetric key.</li>
<li><code>--pin PIN</code> - PKCS11 (smart-card's) pin code.</li>
<li><code>--key-id</code> - PKCS11 key ID.</li>
<li><code>--key-label</code> - PKCS11 key label.</li>
<li><code>--library PKCS11_LIBRARY</code> - path to the PKCS11 library. Same as in encryption case.</li>
<li><code>--server ID URL(s)</code> - specifies a key or share server. Same as in encryption case.</li>
<li><code>--accept SERVER_CERT_FILENAME</code> - path to server's TLS certificate file. Same as in encryption case.</li>
<li><code>FILE</code> - encrypted file to be decrypted.</li>
<li><code>OUTPUT_DIR</code> - output directory where the files are decrypted. If not specified then current working directory is used. If there is already a file with same name then it is overwritten.</li>
</ul>
<h2><a class="anchor" id="autotoc_md62"></a>
Examples</h2>
<ol type="1">
<li><p class="startli"><b>Decrypt a file with a password</b> <br  />
 Decrypt the file <code>abc.txt-pw.cdoc</code> using the key with label <code>Test</code> and password <code>Test123</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool decrypt --label Test --password Test123 abc.txt-pw.cdoc</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Decrypt a file with an ID card</b> <br  />
 Decrypt the file <code>abc.txt-p11pk.cdoc</code> using the key from lock <code>1</code> and an Estonian ID card with PIN code <code>1234</code>.</p>
<div class="fragment"><div class="line">./cdoc-tool decrypt --label_idx 1 --pin 1234 --slot 0 --key-label Isikutuvastus --library /opt/homebrew/lib/opensc-pkcs11.so abc.txt-p11pk.cdoc</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Decrypt a file with an ID card and use key server</b> <br  />
 Decrypt the file <code>abc.txt-ks.cdoc</code> using the key with label <code>Test</code> and a private key from an ID card, using the RIA key server.</p>
<div class="fragment"><div class="line">./cdoc-tool decrypt --library /opt/homebrew/lib/opensc-pkcs11.so --server 00000000-0000-0000-0000-000000000000 https://cdoc2.id.ee:8444 --accept keyserver-cert.der --label Test --slot 0 --pin 1234 --key-label Isikutuvastus abc.txt-ks.cdoc out</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md64"></a>
Viewing Locks</h1>
<p>To view the locks in a container, use the following syntax:</p>
<div class="fragment"><div class="line">cdoc-tool locks FILE</div>
</div><!-- fragment --><p>This command does not have any options. The only argument is the encrypted container file whose locks will be displayed.</p>
<h2><a class="anchor" id="autotoc_md65"></a>
Example</h2>
<p>Display the locks of the file <code>abc.txt-aes.cdoc</code>:</p>
<div class="fragment"><div class="line">./cdoc-tool locks abc.txt-aes.cdoc</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 16 2025 13:17:06 for libcdoc by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
